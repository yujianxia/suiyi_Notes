(window.webpackJsonp=window.webpackJsonp||[]).push([[385],{745:function(t,a,s){"use strict";s.r(a);var e=s(25),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("ç»è¿‡äº”ç« çš„å­¦ä¹ ï¼Œç»ˆäºå›åˆ°äº†"),s("code",[t._v("React")]),t._v("åº”ç”¨çš„èµ·ç‚¹ã€‚")]),t._v(" "),s("p",[t._v("è¿™ä¸€èŠ‚å®Œæ•´çš„èµ°é€š"),s("code",[t._v("ReactDOM.render")]),t._v("å®Œæˆé¡µé¢æ¸²æŸ“çš„æ•´ä¸ªæµç¨‹ã€‚")]),t._v(" "),s("h2",{attrs:{id:"åˆ›å»ºfiber"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºfiber"}},[t._v("#")]),t._v(" åˆ›å»ºfiber")]),t._v(" "),s("p",[t._v("ä»"),s("RouterLink",{attrs:{to:"/react/process/doubleBuffer.html#mountæ—¶"}},[t._v("åŒç¼“å­˜æœºåˆ¶ä¸€èŠ‚")]),t._v("çŸ¥é“ï¼Œé¦–æ¬¡æ‰§è¡Œ"),s("code",[t._v("ReactDOM.render")]),t._v("ä¼šåˆ›å»º"),s("code",[t._v("fiberRootNode")]),t._v("å’Œ"),s("code",[t._v("rootFiber")]),t._v("ã€‚å…¶ä¸­"),s("code",[t._v("fiberRootNode")]),t._v("æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹ï¼Œ"),s("code",[t._v("rootFiber")]),t._v("æ˜¯è¦æ¸²æŸ“ç»„ä»¶æ‰€åœ¨ç»„ä»¶æ ‘çš„"),s("code",[t._v("æ ¹èŠ‚ç‚¹")]),t._v("ã€‚")],1),t._v(" "),s("p",[t._v("è¿™ä¸€æ­¥å‘ç”Ÿåœ¨è°ƒç”¨"),s("code",[t._v("ReactDOM.render")]),t._v("åè¿›å…¥çš„"),s("code",[t._v("legacyRenderSubtreeIntoContainer")]),t._v("æ–¹æ³•ä¸­ã€‚")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// containeræŒ‡ReactDOM.renderçš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå³åº”ç”¨æŒ‚è½½çš„DOMèŠ‚ç‚¹ï¼‰")]),t._v("\nroot "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" container"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_reactRootContainer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("legacyCreateRootFromDOMContainer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  container"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  forceHydrate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nfiberRoot "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_internalRoot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("blockquote",[s("p",[t._v("ä½ å¯ä»¥ä»"),s("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-dom/src/client/ReactDOMLegacy.js#L193",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ"),s("OutboundLink")],1),t._v("çœ‹åˆ°è¿™ä¸€æ­¥çš„ä»£ç ")])]),t._v(" "),s("p",[s("code",[t._v("legacyCreateRootFromDOMContainer")]),t._v("æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨"),s("code",[t._v("createFiberRoot")]),t._v("æ–¹æ³•å®Œæˆ"),s("code",[t._v("fiberRootNode")]),t._v("å’Œ"),s("code",[t._v("rootFiber")]),t._v("çš„åˆ›å»ºä»¥åŠå…³è”ã€‚å¹¶åˆå§‹åŒ–"),s("code",[t._v("updateQueue")]),t._v("ã€‚")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createFiberRoot")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("containerInfo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  tag"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" RootTag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  hydrate"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  hydrationCallbacks"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SuspenseHydrationCallbacks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FiberRoot "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºfiberRootNode")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" root"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FiberRoot "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FiberRootNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("containerInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºrootFiber")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" uninitializedFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createHostRootFiber")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿æ¥rootFiberä¸fiberRootNode")]),t._v("\n  root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" uninitializedFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  uninitializedFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆå§‹åŒ–updateQueue")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initializeUpdateQueue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uninitializedFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br")])]),s("p",[t._v("æ ¹æ®ä»¥ä¸Šä»£ç ï¼Œç°åœ¨å¯ä»¥åœ¨"),s("RouterLink",{attrs:{to:"/react/process/doubleBuffer.html#mountæ—¶"}},[t._v("åŒç¼“å­˜æœºåˆ¶ä¸€èŠ‚")]),t._v("åŸºç¡€ä¸Šè¡¥å……ä¸Š"),s("code",[t._v("rootFiber")]),t._v("åˆ°"),s("code",[t._v("fiberRootNode")]),t._v("çš„å¼•ç”¨ã€‚")],1),t._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"fiberRoot",href:"/notes/assets/react/fiberroot.png"}},[s("img",{attrs:{src:"/notes/assets/react/fiberroot.png",alt:"fiberRoot"}})])]),t._v(" "),s("blockquote",[s("p",[t._v("ä½ å¯ä»¥ä»"),s("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberRoot.new.js#L97",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ"),s("OutboundLink")],1),t._v("çœ‹åˆ°è¿™ä¸€æ­¥çš„ä»£ç ")])]),t._v(" "),s("h2",{attrs:{id:"åˆ›å»ºupdate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºupdate"}},[t._v("#")]),t._v(" åˆ›å»ºupdate")]),t._v(" "),s("p",[t._v("å·²ç»åšå¥½äº†ç»„ä»¶çš„åˆå§‹åŒ–å·¥ä½œï¼Œæ¥ä¸‹æ¥å°±ç­‰å¾…åˆ›å»º"),s("code",[t._v("Update")]),t._v("æ¥å¼€å¯ä¸€æ¬¡æ›´æ–°ã€‚")]),t._v(" "),s("p",[t._v("è¿™ä¸€æ­¥å‘ç”Ÿåœ¨"),s("code",[t._v("updateContainer")]),t._v("æ–¹æ³•ä¸­ã€‚")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateContainer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("element"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ReactNodeList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  container"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" OpaqueRoot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  parentComponent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("React$Component"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  callback"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("Function"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Lane "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...çœç•¥ä¸é€»è¾‘ä¸ç›¸å…³ä»£ç ")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºupdate")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" update "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createUpdate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lane"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" suspenseConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// update.payloadä¸ºéœ€è¦æŒ‚è½½åœ¨æ ¹èŠ‚ç‚¹çš„ç»„ä»¶")]),t._v("\n  update"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("payload "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("element"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// callbackä¸ºReactDOM.renderçš„ç¬¬ä¸‰ä¸ªå‚æ•° â€”â€” å›è°ƒå‡½æ•°")]),t._v("\n  callback "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callback "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    update"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callback "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†ç”Ÿæˆçš„updateåŠ å…¥updateQueue")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("enqueueUpdate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" update"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è°ƒåº¦æ›´æ–°")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduleUpdateOnFiber")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lane"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...çœç•¥ä¸é€»è¾‘ä¸ç›¸å…³ä»£ç ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br")])]),s("blockquote",[s("p",[t._v("ä½ å¯ä»¥ä»"),s("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberReconciler.new.js#L255",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ"),s("OutboundLink")],1),t._v("çœ‹åˆ°"),s("code",[t._v("updateContainer")]),t._v("çš„ä»£ç ")])]),t._v(" "),s("p",[t._v("å€¼å¾—æ³¨æ„çš„æ˜¯å…¶ä¸­"),s("code",[t._v("update.payload = {element};")])]),t._v(" "),s("p",[t._v("è¿™å°±æ˜¯åœ¨"),s("RouterLink",{attrs:{to:"/react/state/update.html#updateçš„ç»“æ„"}},[t._v("Updateä¸€èŠ‚")]),t._v("ä»‹ç»çš„ï¼Œå¯¹äº"),s("code",[t._v("HostRoot")]),t._v("ï¼Œ"),s("code",[t._v("payload")]),t._v("ä¸º"),s("code",[t._v("ReactDOM.render")]),t._v("çš„ç¬¬ä¸€ä¸ªä¼ å‚ã€‚")],1),t._v(" "),s("h2",{attrs:{id:"æµç¨‹æ¦‚è§ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµç¨‹æ¦‚è§ˆ"}},[t._v("#")]),t._v(" æµç¨‹æ¦‚è§ˆ")]),t._v(" "),s("p",[t._v("è‡³æ­¤ï¼Œ"),s("code",[t._v("ReactDOM.render")]),t._v("çš„æµç¨‹å°±å’Œå·²çŸ¥çš„æµç¨‹è¿æ¥ä¸Šäº†ã€‚")]),t._v(" "),s("p",[t._v("æ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("åˆ›å»ºfiberRootNodeã€rootFiberã€updateQueueï¼ˆ"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("legacyCreateRootFromDOMContainer"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ï¼‰\n\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\nåˆ›å»ºUpdateå¯¹è±¡ï¼ˆ"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("updateContainer"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ï¼‰\n\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\nä»fiberåˆ°rootï¼ˆ"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("markUpdateLaneFromFiberToRoot"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ï¼‰\n\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\nè°ƒåº¦æ›´æ–°ï¼ˆ"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("ensureRootIsScheduled"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ï¼‰\n\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\nrenderé˜¶æ®µï¼ˆ"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("performSyncWorkOnRoot"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" æˆ– "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("performConcurrentWorkOnRoot"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ï¼‰\n\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\ncommité˜¶æ®µï¼ˆ"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("commitRoot"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ï¼‰\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br")])]),s("h2",{attrs:{id:"reactçš„å…¶ä»–å…¥å£å‡½æ•°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reactçš„å…¶ä»–å…¥å£å‡½æ•°"}},[t._v("#")]),t._v(" Reactçš„å…¶ä»–å…¥å£å‡½æ•°")]),t._v(" "),s("p",[t._v("å½“å‰"),s("code",[t._v("React")]),t._v("å…±æœ‰ä¸‰ç§æ¨¡å¼ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("legacy")]),t._v("ï¼Œè¿™æ˜¯å½“å‰"),s("code",[t._v("React")]),t._v("ä½¿ç”¨çš„æ–¹å¼ã€‚å½“å‰æ²¡æœ‰è®¡åˆ’åˆ é™¤æœ¬æ¨¡å¼ï¼Œä½†æ˜¯è¿™ä¸ªæ¨¡å¼å¯èƒ½ä¸æ”¯æŒä¸€äº›æ–°åŠŸèƒ½ã€‚")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("blocking")]),t._v("ï¼Œå¼€å¯éƒ¨åˆ†"),s("code",[t._v("concurrent")]),t._v("æ¨¡å¼ç‰¹æ€§çš„ä¸­é—´æ¨¡å¼ã€‚ç›®å‰æ­£åœ¨å®éªŒä¸­ã€‚ä½œä¸ºè¿ç§»åˆ°"),s("code",[t._v("concurrent")]),t._v("æ¨¡å¼çš„ç¬¬ä¸€ä¸ªæ­¥éª¤ã€‚")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("concurrent")]),t._v("ï¼Œé¢å‘æœªæ¥çš„å¼€å‘æ¨¡å¼ã€‚ä¹‹å‰è®²çš„"),s("code",[t._v("ä»»åŠ¡ä¸­æ–­/ä»»åŠ¡ä¼˜å…ˆçº§")]),t._v("éƒ½æ˜¯é’ˆå¯¹"),s("code",[t._v("concurrent")]),t._v("æ¨¡å¼ã€‚")])])]),t._v(" "),s("p",[t._v("ä½ å¯ä»¥ä»ä¸‹è¡¨çœ‹å‡ºå„ç§æ¨¡å¼å¯¹ç‰¹æ€§çš„æ”¯æŒï¼š")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th"),t._v(" "),s("th",[t._v("legacy æ¨¡å¼")]),t._v(" "),s("th",[t._v("blocking æ¨¡å¼")]),t._v(" "),s("th",[t._v("concurrent æ¨¡å¼")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/refs-and-the-dom.html#legacy-api-string-refs",target:"_blank",rel:"noopener noreferrer"}},[t._v("String Refs"),s("OutboundLink")],1)]),t._v(" "),s("td",[t._v("âœ…")]),t._v(" "),s("td",[t._v("ğŸš«**")]),t._v(" "),s("td",[t._v("ğŸš«**")])]),t._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/legacy-context.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Legacy Context"),s("OutboundLink")],1)]),t._v(" "),s("td",[t._v("âœ…")]),t._v(" "),s("td",[t._v("ğŸš«**")]),t._v(" "),s("td",[t._v("ğŸš«**")])]),t._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/strict-mode.html#warning-about-deprecated-finddomnode-usage",target:"_blank",rel:"noopener noreferrer"}},[t._v("findDOMNode"),s("OutboundLink")],1)]),t._v(" "),s("td",[t._v("âœ…")]),t._v(" "),s("td",[t._v("ğŸš«**")]),t._v(" "),s("td",[t._v("ğŸš«**")])]),t._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-suspense.html#what-is-suspense-exactly",target:"_blank",rel:"noopener noreferrer"}},[t._v("Suspense"),s("OutboundLink")],1)]),t._v(" "),s("td",[t._v("âœ…")]),t._v(" "),s("td",[t._v("âœ…")]),t._v(" "),s("td",[t._v("âœ…")])]),t._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#suspenselist",target:"_blank",rel:"noopener noreferrer"}},[t._v("SuspenseList"),s("OutboundLink")],1)]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("âœ…")]),t._v(" "),s("td",[t._v("âœ…")])]),t._v(" "),s("tr",[s("td",[t._v("Suspense SSR + Hydration")]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("âœ…")]),t._v(" "),s("td",[t._v("âœ…")])]),t._v(" "),s("tr",[s("td",[t._v("Progressive Hydration")]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("âœ…")]),t._v(" "),s("td",[t._v("âœ…")])]),t._v(" "),s("tr",[s("td",[t._v("Selective Hydration")]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("âœ…")])]),t._v(" "),s("tr",[s("td",[t._v("Cooperative Multitasking")]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("âœ…")])]),t._v(" "),s("tr",[s("td",[t._v("Automatic batching of multiple setStates")]),t._v(" "),s("td",[t._v("ğŸš«*")]),t._v(" "),s("td",[t._v("âœ…")]),t._v(" "),s("td",[t._v("âœ…")])]),t._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#splitting-high-and-low-priority-state",target:"_blank",rel:"noopener noreferrer"}},[t._v("Priority-based Rendering"),s("OutboundLink")],1)]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("âœ…")])]),t._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-intro.html#interruptible-rendering",target:"_blank",rel:"noopener noreferrer"}},[t._v("Interruptible Prerendering"),s("OutboundLink")],1)]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("âœ…")])]),t._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#transitions",target:"_blank",rel:"noopener noreferrer"}},[t._v("useTransition"),s("OutboundLink")],1)]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("âœ…")])]),t._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#deferring-a-value",target:"_blank",rel:"noopener noreferrer"}},[t._v("useDeferredValue"),s("OutboundLink")],1)]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("âœ…")])]),t._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#suspense-reveal-train",target:"_blank",rel:"noopener noreferrer"}},[t._v('Suspense Reveal "Train"'),s("OutboundLink")],1)]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("ğŸš«")]),t._v(" "),s("td",[t._v("âœ…")])])])]),t._v(" "),s("p",[t._v("*ï¼š"),s("code",[t._v("legacy")]),t._v("æ¨¡å¼åœ¨åˆæˆäº‹ä»¶ä¸­æœ‰è‡ªåŠ¨æ‰¹å¤„ç†çš„åŠŸèƒ½ï¼Œä½†ä»…é™äºä¸€ä¸ªæµè§ˆå™¨ä»»åŠ¡ã€‚é"),s("code",[t._v("React")]),t._v("äº‹ä»¶æƒ³ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½å¿…é¡»ä½¿ç”¨ "),s("code",[t._v("unstable_batchedUpdates")]),t._v("ã€‚åœ¨"),s("code",[t._v("blocking")]),t._v("æ¨¡å¼å’Œ"),s("code",[t._v("concurrent")]),t._v("æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„"),s("code",[t._v("setState")]),t._v("åœ¨é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯æ‰¹å¤„ç†çš„ã€‚")]),t._v(" "),s("p",[t._v("**ï¼šä¼šåœ¨å¼€å‘ä¸­å‘å‡ºè­¦å‘Šã€‚")]),t._v(" "),s("p",[t._v("æ¨¡å¼çš„å˜åŒ–å½±å“æ•´ä¸ªåº”ç”¨çš„å·¥ä½œæ–¹å¼ï¼Œæ‰€ä»¥æ— æ³•åªé’ˆå¯¹æŸä¸ªç»„ä»¶å¼€å¯ä¸åŒæ¨¡å¼ã€‚")]),t._v(" "),s("p",[t._v("åŸºäºæ­¤åŸå› ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„"),s("code",[t._v("å…¥å£å‡½æ•°")]),t._v("å¼€å¯ä¸åŒæ¨¡å¼ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("legacy")]),t._v(" -- "),s("code",[t._v("ReactDOM.render(<App />, rootNode)")])]),t._v(" "),s("li",[s("code",[t._v("blocking")]),t._v(" -- "),s("code",[t._v("ReactDOM.createBlockingRoot(rootNode).render(<App />)")])]),t._v(" "),s("li",[s("code",[t._v("concurrent")]),t._v(" -- "),s("code",[t._v("ReactDOM.createRoot(rootNode).render(<App />)")])])]),t._v(" "),s("blockquote",[s("p",[t._v("ä½ å¯ä»¥åœ¨"),s("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-adoption.html#why-so-many-modes",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ"),s("OutboundLink")],1),t._v("çœ‹åˆ°"),s("code",[t._v("React")]),t._v("å›¢é˜Ÿè§£é‡Šä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šæ¨¡å¼")])]),t._v(" "),s("p",[t._v("è™½ç„¶ä¸åŒæ¨¡å¼çš„"),s("code",[t._v("å…¥å£å‡½æ•°")]),t._v("ä¸åŒï¼Œä½†æ˜¯ä»–ä»¬ä»…å¯¹"),s("code",[t._v("fiber.mode")]),t._v("å˜é‡äº§ç”Ÿå½±å“ï¼Œå¯¹åœ¨"),s("RouterLink",{attrs:{to:"/react/state/reactdom.html#æµç¨‹æ¦‚è§ˆ"}},[t._v("æµç¨‹æ¦‚è§ˆ")]),t._v("ä¸­æè¿°çš„æµç¨‹å¹¶æ— å½±å“ã€‚")],1)])}),[],!1,null,null,null);a.default=n.exports}}]);