(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{408:function(t,s,e){"use strict";e.r(s);var a=e(25),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"在-fiberscheduler-中的全局变量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在-fiberscheduler-中的全局变量"}},[t._v("#")]),t._v(" "),e("strong",[t._v("在 FiberScheduler 中的全局变量")])]),t._v(" "),e("div",{staticClass:"language-javascript line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Used to ensure computeUniqueAsyncExpiration is monotonically increasing.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用于确保computeUniqueAsyncExpiration单调增加。")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lastUniqueAsyncExpiration"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" number "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Represents the expiration time that incoming updates should use. (If this")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// is NoWork, use the default strategy: async updates in async mode, sync")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// updates in sync mode.)")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 表示传入更新应使用的到期时间。 （如果这是NoWork，请使用默认策略：在异步模式下进行异步更新，同步以同步模式更新。）")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" expirationContext"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ExpirationTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NoWork\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isWorking"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The next work in progress fiber that we're currently working on.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当前正在研究的下一个正在进行的fiber。")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextUnitOfWork"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextRoot"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FiberRoot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The time at which we're currently rendering work.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 目前正在渲染工作的时间。")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextRenderExpirationTime"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ExpirationTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NoWork\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextLatestAbsoluteTimeoutMs"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" number "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextRenderDidError"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The next fiber with an effect that we're currently committing.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 具有当前承诺作用的下一个fiber。")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextEffect"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isCommitting"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" legacyErrorBoundariesThatAlreadyFailed"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Set"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mixed"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Used for performance tracking.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用于性能跟踪。")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" interruptedBy"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br"),e("span",{staticClass:"line-number"},[t._v("23")]),e("br"),e("span",{staticClass:"line-number"},[t._v("24")]),e("br"),e("span",{staticClass:"line-number"},[t._v("25")]),e("br"),e("span",{staticClass:"line-number"},[t._v("26")]),e("br"),e("span",{staticClass:"line-number"},[t._v("27")]),e("br"),e("span",{staticClass:"line-number"},[t._v("28")]),e("br"),e("span",{staticClass:"line-number"},[t._v("29")]),e("br"),e("span",{staticClass:"line-number"},[t._v("30")]),e("br"),e("span",{staticClass:"line-number"},[t._v("31")]),e("br"),e("span",{staticClass:"line-number"},[t._v("32")]),e("br"),e("span",{staticClass:"line-number"},[t._v("33")]),e("br")])]),e("h2",{attrs:{id:"lastuniqueasyncexpiration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lastuniqueasyncexpiration"}},[t._v("#")]),t._v(" "),e("strong",[t._v("lastUniqueAsyncExpiration")])]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("createBatch")]),t._v("中有调用，但是没发现"),e("code",[t._v("createBatch")]),t._v("在哪里被调用，所以，目前没发现什么作用。")]),t._v(" "),e("div",{staticClass:"language-javascript line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("computeUniqueAsyncExpiration")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ExpirationTime "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" currentTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestCurrentTime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" result "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("computeAsyncExpiration")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentTime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" lastUniqueAsyncExpiration"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        result "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lastUniqueAsyncExpiration "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    lastUniqueAsyncExpiration "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" lastUniqueAsyncExpiration\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br")])]),e("h2",{attrs:{id:"expirationcontext"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#expirationcontext"}},[t._v("#")]),t._v(" "),e("strong",[t._v("expirationContext")])]),t._v(" "),e("p",[t._v("保存创建"),e("code",[t._v("expirationTime")]),t._v("的上下文，在"),e("code",[t._v("syncUpdates")]),t._v("和"),e("code",[t._v("deferredUpdates")]),t._v("中分别被设置为"),e("code",[t._v("Sync")]),t._v("和"),e("code",[t._v("AsyncExpirationTime")]),t._v("，在有这个上下文的时候任何更新计算出来的过期时间都等于"),e("code",[t._v("expirationContext")]),t._v("。")]),t._v(" "),e("p",[t._v("比如调用"),e("code",[t._v("ReactDOM.flushSync")]),t._v("的时候，他接受的回调中的"),e("code",[t._v("setState")])]),t._v(" "),e("h2",{attrs:{id:"isworking"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#isworking"}},[t._v("#")]),t._v(" "),e("strong",[t._v("isWorking")])]),t._v(" "),e("p",[e("code",[t._v("commitRoot")]),t._v("和"),e("code",[t._v("renderRoot")]),t._v("开始都会设置为"),e("code",[t._v("true")]),t._v("，然后在他们各自阶段结束的时候都重置为"),e("code",[t._v("false")])]),t._v(" "),e("p",[e("strong",[t._v("用来标志是否当前有更新正在进行，不区分阶段")])]),t._v(" "),e("h2",{attrs:{id:"iscommitting"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#iscommitting"}},[t._v("#")]),t._v(" "),e("strong",[t._v("isCommitting")])]),t._v(" "),e("p",[e("code",[t._v("commitRoot")]),t._v("开头设置为"),e("code",[t._v("true")]),t._v("，结束之后设置为"),e("code",[t._v("false")])]),t._v(" "),e("p",[e("strong",[t._v("用来标志是否处于"),e("code",[t._v("commit")]),t._v("阶段")])]),t._v(" "),e("h2",{attrs:{id:"nextunitofwork"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nextunitofwork"}},[t._v("#")]),t._v(" "),e("strong",[t._v("nextUnitOfWork")])]),t._v(" "),e("p",[t._v("用于记录"),e("code",[t._v("render")]),t._v("阶段"),e("code",[t._v("Fiber")]),t._v("树遍历过程中下一个需要执行的节点。")]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("resetStack")]),t._v("中分别被重置")]),t._v(" "),e("p",[t._v("他只会指向"),e("code",[t._v("workInProgress")])]),t._v(" "),e("h2",{attrs:{id:"nextroot-nextrenderexpirationtime"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nextroot-nextrenderexpirationtime"}},[t._v("#")]),t._v(" "),e("strong",[t._v("nextRoot & nextRenderExpirationTime")])]),t._v(" "),e("p",[t._v("用于记录"),e("strong",[t._v("下一个将要渲染的root节点")]),t._v("和"),e("strong",[t._v("下一个要渲染的任务")])]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("renderRoot")]),t._v("开始的时候赋值，需要符合如下条件才会重新赋值")]),t._v(" "),e("div",{staticClass:"language-javascript line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    expirationTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" nextRenderExpirationTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n    root "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" nextRoot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n    nextUnitOfWork "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("resetStack")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    nextRoot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root\n    nextRenderExpirationTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" expirationTime\n    nextUnitOfWork "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createWorkInProgress")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        nextRoot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        nextRenderExpirationTime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br")])]),e("p",[t._v("解释一下就是说，只有这一次调用"),e("code",[t._v("renderRoot")]),t._v("的时候，有")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("新的"),e("code",[t._v("root")]),t._v("要渲染")])]),t._v(" "),e("li",[e("p",[t._v("相同的"),e("code",[t._v("root")]),t._v("但是任务有不同优先级的任务要渲染")])]),t._v(" "),e("li",[e("p",[t._v("或者在老的任务上没有下一个节点需要渲染了")])])]),t._v(" "),e("h2",{attrs:{id:"nextlatestabsolutetimeoutms"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nextlatestabsolutetimeoutms"}},[t._v("#")]),t._v(" "),e("strong",[t._v("nextLatestAbsoluteTimeoutMs")])]),t._v(" "),e("p",[t._v("用来记录"),e("code",[t._v("Suspense")]),t._v("组件何时重新尝试渲染，涉及复杂的公式")]),t._v(" "),e("h2",{attrs:{id:"nextrenderdiderror"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nextrenderdiderror"}},[t._v("#")]),t._v(" "),e("strong",[t._v("nextRenderDidError")])]),t._v(" "),e("p",[t._v("用于记录当前"),e("code",[t._v("render")]),t._v("流程是否有错误产生")]),t._v(" "),e("p",[e("code",[t._v("resetStack")]),t._v("重置为"),e("code",[t._v("false")])]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("throwException")]),t._v("中如果发现了不能直接处理的错误（除了 Promise 之外），那么就调用"),e("code",[t._v("renderDidError")]),t._v("设置为"),e("code",[t._v("true")])]),t._v(" "),e("h2",{attrs:{id:"nexteffect"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nexteffect"}},[t._v("#")]),t._v(" "),e("strong",[t._v("nextEffect")])]),t._v(" "),e("p",[t._v("用于"),e("code",[t._v("commit")]),t._v("阶段记录"),e("code",[t._v("firstEffect")]),t._v(" -> "),e("code",[t._v("lastEffect")]),t._v("链遍历过程中的每一个"),e("code",[t._v("Fiber")])]),t._v(" "),e("h2",{attrs:{id:"interruptedby"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#interruptedby"}},[t._v("#")]),t._v(" "),e("strong",[t._v("interruptedBy")])]),t._v(" "),e("p",[t._v("给开发工具用的，用来展示被哪个节点打断了异步任务")]),t._v(" "),e("h2",{attrs:{id:"跟调度有关的全局变量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#跟调度有关的全局变量"}},[t._v("#")]),t._v(" "),e("strong",[t._v("跟调度有关的全局变量")])]),t._v(" "),e("blockquote",[e("p",[t._v("ReactFiberScheduler.js 1797-1826")])]),t._v(" "),e("div",{staticClass:"language-javascript line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Linked-list of roots")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根链接列表")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" firstScheduledRoot"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FiberRoot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lastScheduledRoot"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FiberRoot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" callbackExpirationTime"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ExpirationTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NoWork\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" callbackID"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isRendering"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextFlushedRoot"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FiberRoot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextFlushedExpirationTime"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ExpirationTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NoWork\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lowestPriorityPendingInteractiveExpirationTime"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ExpirationTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NoWork\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" deadlineDidExpire"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" hasUnhandledError"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" unhandledError"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mixed "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" deadline"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Deadline "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isBatchingUpdates"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isUnbatchingUpdates"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isBatchingInteractiveUpdates"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" completedBatches"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Array"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Batch"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" originalStartTimeMs"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" number "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" currentRendererTime"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ExpirationTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("msToExpirationTime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    originalStartTimeMs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" currentSchedulerTime"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ExpirationTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" currentRendererTime\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Use these to prevent an infinite loop of nested updates")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用这些来防止嵌套更新的无限循环")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NESTED_UPDATE_LIMIT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nestedUpdateCount"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" number "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lastCommittedRootDuringThisBatch"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FiberRoot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br"),e("span",{staticClass:"line-number"},[t._v("23")]),e("br"),e("span",{staticClass:"line-number"},[t._v("24")]),e("br"),e("span",{staticClass:"line-number"},[t._v("25")]),e("br"),e("span",{staticClass:"line-number"},[t._v("26")]),e("br"),e("span",{staticClass:"line-number"},[t._v("27")]),e("br"),e("span",{staticClass:"line-number"},[t._v("28")]),e("br"),e("span",{staticClass:"line-number"},[t._v("29")]),e("br"),e("span",{staticClass:"line-number"},[t._v("30")]),e("br"),e("span",{staticClass:"line-number"},[t._v("31")]),e("br"),e("span",{staticClass:"line-number"},[t._v("32")]),e("br"),e("span",{staticClass:"line-number"},[t._v("33")]),e("br")])]),e("h2",{attrs:{id:"firstscheduledroot-lastscheduledroot"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#firstscheduledroot-lastscheduledroot"}},[t._v("#")]),t._v(" "),e("strong",[t._v("firstScheduledRoot & lastScheduledRoot")])]),t._v(" "),e("p",[t._v("用于存放有任务的所有"),e("code",[t._v("root")]),t._v("的单列表结构")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("在"),e("code",[t._v("findHighestPriorityRoot")]),t._v("用来检索优先级最高的"),e("code",[t._v("root")])])]),t._v(" "),e("li",[e("p",[t._v("在"),e("code",[t._v("addRootToSchedule")]),t._v("中会修改")])])]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("findHighestPriorityRoot")]),t._v("中会判断"),e("code",[t._v("root")]),t._v("的"),e("code",[t._v("expirationTime")]),t._v("，并不会直接删除"),e("code",[t._v("root")])]),t._v(" "),e("h2",{attrs:{id:"callbackexpirationtime-callbackid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#callbackexpirationtime-callbackid"}},[t._v("#")]),t._v(" "),e("strong",[t._v("callbackExpirationTime & callbackID")])]),t._v(" "),e("p",[t._v("记录请求"),e("code",[t._v("ReactScheduler")]),t._v("的时候用的过期时间，如果在一次调度期间有新的调度请求进来了，而且优先级更高，那么需要取消上一次请求，如果更低则无需再次请求调度。")]),t._v(" "),e("p",[e("code",[t._v("callbackID")]),t._v("是"),e("code",[t._v("ReactScheduler")]),t._v("返回的用于取消调度的 ID")]),t._v(" "),e("h2",{attrs:{id:"isrendering"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#isrendering"}},[t._v("#")]),t._v(" "),e("strong",[t._v("isRendering")])]),t._v(" "),e("p",[e("code",[t._v("performWorkOnRoot")]),t._v("开始设置为"),e("code",[t._v("true")]),t._v("，结束的时候设置为"),e("code",[t._v("false")]),t._v("，表示进入渲染阶段，这是包含"),e("code",[t._v("render")]),t._v("和"),e("code",[t._v("commit")]),t._v("阶段的。")]),t._v(" "),e("h2",{attrs:{id:"nextflushedroot-nextflushedexpirationtime"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nextflushedroot-nextflushedexpirationtime"}},[t._v("#")]),t._v(" "),e("strong",[t._v("nextFlushedRoot & nextFlushedExpirationTime")])]),t._v(" "),e("p",[t._v("用来标志下一个需要渲染的"),e("code",[t._v("root")]),t._v("和对应的"),e("code",[t._v("expirtaionTime")]),t._v("，注意：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("通过"),e("code",[t._v("findHighestPriorityRoot")]),t._v("找到最高优先级的")])]),t._v(" "),e("li",[e("p",[t._v("通过"),e("code",[t._v("flushRoot")]),t._v("会直接设置指定的，不进行筛选")])])]),t._v(" "),e("h2",{attrs:{id:"lowestprioritypendinginteractiveexpirationtime"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lowestprioritypendinginteractiveexpirationtime"}},[t._v("#")]),t._v(" "),e("strong",[t._v("lowestPriorityPendingInteractiveExpirationTime")])]),t._v(" "),e("p",[t._v("类似"),e("code",[t._v("expirationContext")]),t._v("，用来存储"),e("code",[t._v("interactiveUpdates")]),t._v("产生的最小的"),e("code",[t._v("expirationTime")]),t._v("，在下一次外部指定的"),e("code",[t._v("interactiveUpdates")]),t._v("情况下会强制输出上一次的"),e("code",[t._v("interactiveUpdates")]),t._v("，"),e("strong",[t._v("因为"),e("code",[t._v("interactiveUpdates")]),t._v("主要是用户输入之类的操作，如果不及时输出会给用户造成断层感")])]),t._v(" "),e("p",[t._v("可以通过调用"),e("code",[t._v("ReactDOM.unstable_interactiveUpdates")]),t._v("来实现以上目的")]),t._v(" "),e("h2",{attrs:{id:"deadline-deadlinedidexpire"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deadline-deadlinedidexpire"}},[t._v("#")]),t._v(" "),e("strong",[t._v("deadline & deadlineDidExpire")])]),t._v(" "),e("p",[e("code",[t._v("deadline")]),t._v("是"),e("code",[t._v("ReactScheduler")]),t._v("中返回的时间片调度信息对象")]),t._v(" "),e("p",[t._v("用于记录是否时间片调度是否过期，在"),e("code",[t._v("shouldYield")]),t._v("根据"),e("code",[t._v("deadline")]),t._v("是否过期来设置")]),t._v(" "),e("h2",{attrs:{id:"hasunhandlederror-unhandlederror"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hasunhandlederror-unhandlederror"}},[t._v("#")]),t._v(" "),e("strong",[t._v("hasUnhandledError & unhandledError")])]),t._v(" "),e("p",[e("code",[t._v("Profiler")]),t._v("调试相关")]),t._v(" "),e("h2",{attrs:{id:"isbatchingupdates-isunbatchingupdates-isbatchinginteractiveupdates"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#isbatchingupdates-isunbatchingupdates-isbatchinginteractiveupdates"}},[t._v("#")]),t._v(" "),e("strong",[t._v("isBatchingUpdates & isUnbatchingUpdates & isBatchingInteractiveUpdates")])]),t._v(" "),e("p",[e("code",[t._v("batchedUpdates")]),t._v("、"),e("code",[t._v("unBatchedUpdates")]),t._v("，"),e("code",[t._v("deferredUpdates")]),t._v("、"),e("code",[t._v("interactiveUpdates")]),t._v("等这些方法用来存储更新产生的上下文的变量")]),t._v(" "),e("h2",{attrs:{id:"originalstarttimems"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#originalstarttimems"}},[t._v("#")]),t._v(" "),e("strong",[t._v("originalStartTimeMs")])]),t._v(" "),e("p",[t._v("固定值，js 加载完一开始计算的结果")]),t._v(" "),e("h2",{attrs:{id:"currentrenderertime-currentschedulertime"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#currentrenderertime-currentschedulertime"}},[t._v("#")]),t._v(" "),e("strong",[t._v("currentRendererTime & currentSchedulerTime")])]),t._v(" "),e("p",[t._v("计算从页面加载到现在为止的毫秒数，后者会在"),e("code",[t._v("isRendering === true")]),t._v("的时候用作固定值返回，不然每次"),e("code",[t._v("requestCurrentTime")]),t._v("都会重新计算新的时间。")]),t._v(" "),e("h2",{attrs:{id:"nestedupdatecount-lastcommittedrootduringthisbatch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nestedupdatecount-lastcommittedrootduringthisbatch"}},[t._v("#")]),t._v(" "),e("strong",[t._v("nestedUpdateCount & lastCommittedRootDuringThisBatch")])]),t._v(" "),e("p",[t._v("用来记录是否有嵌套得再生命周期方法中产生更新导致应用无限循环更新得计数器，用于提醒用户书写的不正确的代码。")])])}),[],!1,null,null,null);s.default=r.exports}}]);