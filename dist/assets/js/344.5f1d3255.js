(window.webpackJsonp=window.webpackJsonp||[]).push([[344],{704:function(e,t,v){"use strict";v.r(t);var a=v(25),_=Object(a.a)({},(function(){var e=this,t=e.$createElement,v=e._self._c||t;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"setstate-执行流程"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#setstate-执行流程"}},[e._v("#")]),e._v(" setState 执行流程")]),e._v(" "),v("p",[e._v("有时表现出异步,有时表现出同步")]),e._v(" "),v("ol",[v("li",[v("p",[e._v("在合成事件和钩子函数当中是异步的，在原生事件和"),v("code",[e._v("setTimeout")]),e._v("当中是同步的")])]),e._v(" "),v("li",[v("p",[e._v("异步并不是说内部是由异步代码组成，本身的执行过程和代码都是同步的，只是合成事件和钩子函数的调用在更新之前，导致拿不到数据形成所谓的异步，可以通过"),v("code",[e._v("setState")]),e._v("的第二个参数(是个回调函数，拿到更新数据)")])]),e._v(" "),v("li",[v("p",[e._v("批量优化也是建立在异步上面，在原生事件和定时事件中不会批量更新，")])]),e._v(" "),v("li",[v("p",[e._v("合成事件(就是给那些元素绑定点击事件等等都属于合成事件)")])])]),e._v(" "),v("h1",{attrs:{id:"setstate-执行原因"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#setstate-执行原因"}},[e._v("#")]),e._v(" setState 执行原因")]),e._v(" "),v("p",[e._v("这样会破坏掉 "),v("code",[e._v("props")]),e._v(" 和 "),v("code",[e._v("state")]),e._v(" 之间的一致性，造成一些难以 debug 的问题。")]),e._v(" "),v("p",[e._v("这样会让一些正在实现的新功能变得无法实现。")]),e._v(" "),v("h1",{attrs:{id:"react-fiber它的目的是解决什么问题"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#react-fiber它的目的是解决什么问题"}},[e._v("#")]),e._v(" React Fiber它的目的是解决什么问题")]),e._v(" "),v("p",[e._v("React的"),v("code",[e._v("Reconciler")]),e._v(" 层负责组建的生命周期运算，diff运算等， React15中被命名为"),v("code",[e._v("Stack Reconciler")]),e._v("，运行过程不能中断，当页面元素较多，执行时间过长，超过16ms的时候，就会出现掉帧的现象。")]),e._v(" "),v("p",[e._v("在React16中，Reconciler改成了Fiber Reconciler，使用了浏览器的"),v("code",[e._v("requestIdleCallback")]),e._v("这一API，用链表的形式来遍历组建树，能灵活的暂停、继续和丢弃执行的任务。使用fiber将任务分割执行，从框架层面降低了掉帧的概率。")]),e._v(" "),v("blockquote",[v("p",[e._v("历史原因")])]),e._v(" "),v("p",[e._v("React 15 的 StackReconciler 方案由于递归不可中断问题，如果 Diff 时间过长（JS计算时间），会造成页面 UI 的无响应（比如输入框）的表现，vdom 无法应用到 dom 中。")]),e._v(" "),v("p",[e._v("为了解决这个问题，React 16 实现了新的基于 "),v("code",[e._v("requestIdleCallback")]),e._v(" 的调度器（因为 "),v("code",[e._v("requestIdleCallback")]),e._v(" 兼容性和稳定性问题，自己实现了 polyfill），通过任务优先级的思想，在高优先级任务进入的时候，中断 reconciler。")]),e._v(" "),v("p",[e._v("为了适配这种新的调度器，推出了 FiberReconciler，将原来的树形结构（vdom）转换成 Fiber 链表的形式（child/sibling/return），整个 Fiber 的遍历是基于循环而非递归，可以随时中断。")]),e._v(" "),v("p",[e._v("更加核心的是，基于 Fiber 的链表结构，对于后续（React 17 lane 架构）的异步渲染和 （可能存在的）worker 计算都有非常好的应用基础")])])}),[],!1,null,null,null);t.default=_.exports}}]);