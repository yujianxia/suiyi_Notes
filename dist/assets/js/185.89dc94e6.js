(window.webpackJsonp=window.webpackJsonp||[]).push([[185],{584:function(t,v,s){"use strict";s.r(v);var a=s(25),_=Object(a.a)({},(function(){var t=this,v=t.$createElement,s=t._self._c||v;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"hybrid"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hybrid"}},[t._v("#")]),t._v(" Hybrid")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("随着 Web技术 和 移动设备 的快速发展，在各家大厂中，Hybrid 技术已经成为一种最主流最不可取代的架构方案之一。一套好的 Hybrid 架构方案能让 App 既能拥有 "),s("strong",[t._v("极致的体验和性能")]),t._v("，同时也能拥有 Web技术 "),s("strong",[t._v("灵活的开发模式、跨平台能力以及热更新机制")]),t._v("。因此，相关的 Hybrid 领域人才也是十分的吃香，精通Hybrid 技术和相关的实战经验，也是面试中一项大大的加分项。")]),t._v(" "),s("h2",{attrs:{id:"_1-混合方案简析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-混合方案简析"}},[t._v("#")]),t._v(" "),s("strong",[t._v("1. 混合方案简析")])]),t._v(" "),s("p",[t._v("Hybrid App，俗称 "),s("strong",[t._v("混合应用")]),t._v("，即混合了 Native技术 与 Web技术 进行开发的移动应用。现在比较流行的混合方案主要有三种，主要是在UI渲染机制上的不同:")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("Webview UI")]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("通过 "),s("strong",[t._v("JSBridge")]),t._v(" 完成 H5 与 Native 的双向通讯，并 "),s("strong",[t._v("基于 Webview")]),t._v(" 进行页面的渲染；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("优势")]),t._v(": 简单易用，架构门槛/成本较低，适用性与灵活性极强；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("劣势")]),t._v(": Webview 性能局限，在复杂页面中，表现远不如原生页面；")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Native UI")]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("通过 "),s("strong",[t._v("JSBridge")]),t._v(" 赋予 H5 原生能力，并进一步将 JS 生成的虚拟节点树(Virtual DOM)传递至 Native 层，并使用 "),s("strong",[t._v("原生系统渲染")]),t._v("。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("优势")]),t._v(": 用户体验基本接近原生，且能发挥 Web技术 开发灵活与易更新的特性；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("劣势")]),t._v(": 上手/改造门槛较高，最好需要掌握一定程度的客户端技术。相比于常规 Web开发，需要更高的开发调试、问题排查成本；")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("小程序")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("通过更加定制化的 "),s("strong",[t._v("JSBridge")]),t._v("，赋予了 Web 更大的权限，并使用双 "),s("code",[t._v("WebView")]),t._v(" 双线程的模式隔离了 "),s("code",[t._v("JS")]),t._v("逻辑 与 "),s("code",[t._v("UI")]),t._v("渲染，形成了特殊的开发模式，加强了 "),s("code",[t._v("H5")]),t._v(" 与 "),s("code",[t._v("Native")]),t._v(" 混合程度，属于第一种方案的优化版本；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("优势")]),t._v(": 用户体验好于常规 "),s("code",[t._v("Webview")]),t._v(" 方案，且通常依托的平台也能提供更为友好的开发调试体验以及功能；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("劣势")]),t._v(": 需要依托于特定的平台的规范限定")])])])])]),t._v(" "),s("p",[s("strong",[t._v("2. Webviev")])]),t._v(" "),s("p",[t._v("Webview 是 Native App 中内置的一款基于 Webkit内核 的浏览器，主要由两部分组成:")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("WebCore 排版引擎")]),t._v("；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("JSCore 解析引擎")]),t._v("；")])])]),t._v(" "),s("p",[t._v("在原生开发 SDK 中 Webview 被封装成了一个组件，用于作为 Web页面 的容器。因此，作为宿主的客户端中拥有更高的权限，可以对 Webview 中的 Web页面 进行配置和开发。")]),t._v(" "),s("p",[t._v("Hybrid技术中双端的交互原理，便是基于 Webview 的一些 API 和特性。")]),t._v(" "),s("h2",{attrs:{id:"_3-交互原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-交互原理"}},[t._v("#")]),t._v(" "),s("strong",[t._v("3. 交互原理")])]),t._v(" "),s("p",[t._v("Hybrid技术 中最核心的点就是 Native端 与 H5端 之间的 "),s("strong",[t._v("双向通讯层")]),t._v("，其实这里也可以理解为需要一套 "),s("strong",[t._v("跨语言通讯方案")]),t._v("，便是常听到的 JSBridge。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("JavaScript 通知 Native")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("API注入")]),t._v("，Native 直接在 JS 上下文中挂载数据或者方法")]),t._v(" "),s("ul",[s("li",[t._v("延迟较低，在安卓4.1以下具有安全性问题，风险较高")])])]),t._v(" "),s("li",[s("p",[t._v("WebView "),s("strong",[t._v("URL Scheme")]),t._v(" 跳转拦截")]),t._v(" "),s("ul",[s("li",[t._v("兼容性好，但延迟较高，且有长度限制")])])]),t._v(" "),s("li",[s("p",[t._v("WebView 中的 "),s("strong",[t._v("prompt/console/alert拦截")]),t._v("(通常使用 prompt)")])])])]),t._v(" "),s("li",[s("p",[t._v("Native 通知 Javascript:")]),t._v(" "),s("ul",[s("li",[t._v("IOS: "),s("code",[t._v("stringByEvaluatingJavaScriptFromString")])])]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Swift")]),t._v("\nwebview"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringByEvaluatingJavaScriptFromString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"alert('NativeCall')\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("ul",[s("li",[t._v("Android: "),s("code",[t._v("loadUrl")]),t._v(" (4.4-)")])]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用js中的JSBridge.trigger方法")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 该方法的弊端是无法获取函数返回值；")]),t._v("\nwebView"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadUrl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"javascript:JSBridge.trigger('NativeCall')\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("ul",[s("li",[t._v("Android: "),s("code",[t._v("evaluateJavascript")]),t._v(" (4.4+)")])]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4.4+后使用该方法便可调用并获取函数返回值；")]),t._v("\nmWebView"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("evaluateJavascript（"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"javascript:JSBridge.trigger('NativeCall')\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \t "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ValueCallback")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    @Override\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onReceiveValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("String value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//此处为 js 返回的结果")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])])])]),t._v(" "),s("h2",{attrs:{id:"_4-接入方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-接入方案"}},[t._v("#")]),t._v(" "),s("strong",[t._v("4. 接入方案")])]),t._v(" "),s("p",[t._v("整套方案需要 Web 与 Native 两部分共同来完成:")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("Native")]),t._v(": 负责实现URL拦截与解析、环境信息的注入、拓展功能的映射、版本更新等功能；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("JavaScirpt")]),t._v(": 负责实现功能协议的拼装、协议的发送、参数的传递、回调等一系列基础功能。")])])]),t._v(" "),s("p",[s("strong",[t._v("接入方式")]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("在线H5")]),t._v(": 直接将项目部署于线上服务器，并由客户端在 HTML 头部注入对应的 Bridge。")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("优势")]),t._v(": 接入/开发成本低，对 App 的侵入小；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("劣势")]),t._v(": 重度依赖网络，无法离线使用，首屏加载慢；")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("内置离线包")]),t._v(": 将代码直接内置于 App 中，即本地存储中，可由 H5 或者 客户端引用 Bridge。")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("优势")]),t._v(": 首屏加载快，可离线化使用；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("劣势")]),t._v(": 开发、调试成本变高，需要多端合作，且会增加 App 包体积")])])])])]),t._v(" "),s("h2",{attrs:{id:"_5-优化方案简述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-优化方案简述"}},[t._v("#")]),t._v(" "),s("strong",[t._v("5. 优化方案简述")])]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("Webview 预加载")]),t._v(": Webview 的初始化其实挺耗时的。测试过，大概在100~200ms之间，因此如果能前置做好初始化于内存中，会大大加快渲染速度。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("更新机制")]),t._v(": 使用离线包的时候，便会涉及到本地离线代码的更新问题，因此需要建立一套云端下发包的机制，由客户端下载云端最新代码包 (zip包)，并解压替换本地代码。")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("增量更新")]),t._v(": 由于下发包是一个下载的过程，因此包的体积越小，下载速度越快，流量损耗越低。只打包改变的文件，客户端下载后覆盖式替换，能大大减小每次更新包的体积。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("条件分发")]),t._v(": 云平台下发更新包时，可以配合客户端设置一系列的条件与规则，从而实现代码的条件更新:")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("单 "),s("strong",[t._v("地区")]),t._v(" 更新: 例如一个只有中国地区才能更新的版本；")])]),t._v(" "),s("li",[s("p",[t._v("按 "),s("strong",[t._v("语言")]),t._v(" 更新: 例如只有中文版本会更新；")])]),t._v(" "),s("li",[s("p",[t._v("按 App "),s("strong",[t._v("版本")]),t._v(" 更新: 例如只有最新版本的 App 才会更新；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("灰度")]),t._v(" 更新: 只有小比例用户会更新；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("AB测试")]),t._v(": 只有命中的用户会更新；")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("降级机制")]),t._v(": 当用户下载或解压代码包失败时，需要有套降级方案，通常有两种做法:")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("本地内置")]),t._v(": 随着 App 打包时内置一份线上最新完整代码包，保证本地代码文件的存在，资源加载均使用本地化路径；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("域名拦截")]),t._v(": 资源加载使用线上域名，通过拦截域名映射到本地路径。当本地不存在时，则请求线上文件，当存在时，直接加载；")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("跨平台部署")]),t._v(": Bridge层 可以做一套浏览器适配，在一些无法适配的功能，做好降级处理，从而保证代码在任何环境的可用性，一套代码可同时运行于 App内 与 普通浏览器；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("环境系统")]),t._v(": 与客户端进行统一配合，搭建出 "),s("strong",[t._v("正式")]),t._v(" / "),s("strong",[t._v("预上线")]),t._v(" / "),s("strong",[t._v("测试")]),t._v(" / "),s("strong",[t._v("开发")]),t._v("环境，能大大提高项目稳定性与问题排查；")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("开发模式")]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("能连接PC Chrome/safari 进行代码调试；")])]),t._v(" "),s("li",[s("p",[t._v("具有开发调试入口，可以使用同样的 Webview 加载开发时的本地代码；")])]),t._v(" "),s("li",[s("p",[t._v("具备日志系统，可以查看 Log 信息；")])])])])])])])])}),[],!1,null,null,null);v.default=_.exports}}]);